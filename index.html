<!doctype html>

<html>

<head>
    <meta charset="utf-8"></meta>
    <title>Conceptoscape</title>

    <script language="JavaScript" type="text/javascript" src='stile.js'></script>
    <script language="JavaScript" type="text/javascript" src='jquery-1.8.3.js'></script>
    <script language="JavaScript" type="text/javascript" src='cytoscape.js'></script>
    <script language="JavaScript" type="text/javascript" src='cytotools.js'></script>
    <link rel="stylesheet" type="text/css" href="cyss.css"/>
</head>

<body>
    <div id='cc'>
        <em>Choose the type</em>
        <select name = "conorrol">
            <option>---</option>
        </select>
        <em> and the entity</em>
        <select name = "lista">
            <option>---</option>
        </select>
        
        <button onclick= "go()">Draw</button>

        <!-- <button class="btn btn-inside btn-boarder"><img src="https://i.cloudup.com/gBzAn-oW_S-2000x2000.png" width="64px" height="64px" id="plane"></button>
        <div class="bg"><img src="https://i.cloudup.com/2ZAX3hVsBE-3000x3000.png" id="bg" width="32px" height="32px" style="opacity:0;"></div>
        <div class="around around-boarder" onclick="go(); ani(); anitwo();"></div> -->
    </div>
    
    
    <div id = 'cyo'></div>

    <script>
        
        //INIZIO INTERAZIONE
        var listaconcetti = [];
        var listaruoli = [];
        readTextFile("book.json", function(text){
            var data = JSON.parse(text);
            for (el in data.Concepts){
                var obj = data.Concepts[el];
                for(id in obj){
                    listaconcetti.push(id);
                }
            }
            for (el in data.Roles){
                var obj = data.Roles[el];
                for(id in obj){
                    listaruoli.push(id);
                }
            }
        });

        var tipo;
        var soggetto;
        $.each(["Concept","Role"],function(index,elem){
            $('select[name = "conorrol"]').append(new Option(elem,index));
        });
        
        $('select[name = "conorrol"]').live("change",function(){
            if($('select[name = "conorrol"] option:selected').text() == "Role") {
                tipo = "starRole";
                $('select[name = "lista"]').empty();
                $('select[name = "lista"]').append(new Option("---",0));
                $.each(listaruoli,function(index,elem){
                    $('select[name = "lista"]').append(new Option(elem,index));
                });
            }
            if($('select[name = "conorrol"] option:selected').text() == "Concept") {
                tipo = "starConcept";
                $('select[name = "lista"]').empty();
                $('select[name = "lista"]').append(new Option("---",0));
                $.each(listaconcetti,function(index,elem){
                    $('select[name = "lista"]').append(new Option(elem,index));
                });
            }
        })

        $('select[name = "lista"]').live("change",function(){
            var x = $('select[name = "lista"] option:selected').text();
            if(x != "---") soggetto = x;
        })


        //CREAZIONE DELL ELEMENTO CY 
        var cy;
        function go(){
            cy = cytoscape({
                container: document.getElementById('cyo'),
                style: stile
            });
        
            
            
            //INIZIO PARSING DEL JSON
            
            readTextFile("book.json", jparse);

            //FINE PARSING DEL JSON
            
            //INIZIO GESTIONE DEL LAYOUT
            
            cy.layout({
                name:'preset',

            }).run(); 

            var nodes = cy.nodes('node');

            if(tipo == 'starConcept') GrapholyConcept(nodes);
            else GrapholyRole(nodes);

            cy.fit(cy.$id(soggetto),300);
            //FINE GESTIONE LAYOUT
            
            //INIZIO GESTIONE NODI FAKE 

            FakeAttrGen();
            FakeRoleGen();
            FakeManager();
            fixSizeLabel()
            

            //FINE GESTIONE NODI FAKE
        }
        
    </script>
    
</body>

